%% Bifurcation

close all 
clear

xmesh = linspace(0,1,500);

alpha=1.2247;
lambda=alpha^2-1;
a0 =2.5;
mu=1;
zeta=0.5;
L=1;
k=((a0^3-1)^2*L^2*mu*zeta)/(4*pi^2*a0*alpha^2);
r=mu*L^2/k;

al=4*a0^2*pi*sqrt(lambda)/r/sqrt(6*a0^12-15*a0^9+...
    17*a0^6-13*a0^3+5);
be=4*a0^2*pi*sqrt(lambda)/r/sqrt(14*a0^12-27*a0^9+...
    37*a0^6-49*a0^3+25);
be/al;

pars.a0=a0;
pars.r=r;
pars.al=al;
pars.be=be;
pars.lambda=lambda;


%% Existence of the first solution (alpha) (+Opposite)

solinit1 = bvpinit(xmesh, @guess1);
sol1 = bvp5c(@bvpfcn, @bcfcn, solinit1);

solinit3 = bvpinit(xmesh, @guess3);
sol3 = bvp5c(@bvpfcn, @bcfcn, solinit3);

%% Existence of the second solution (beta)

solinit2 = bvpinit(xmesh, @guess2);
sol2 = bvp5c(@bvpfcn, @bcfcn, solinit2);

solinit4 = bvpinit(xmesh, @guess4);
sol4 = bvp5c(@bvpfcn, @bcfcn, solinit4);


%% Plot
%{
figure()
sgtitle(['\lambda=',num2str(lambda)])

subplot(2,2,1)
title('Mode 1 (\alpha>0)')
hold on
plot(sol1.x,sol1.y(1,1:end),'-. r')
plot(sol1.x,sol1.y(2,1:end),'-. b')
plot(solinit1.x,solinit1.y(1,1:end),'-r')
plot(solinit1.x,solinit1.y(2,1:end),'-b')
%plot(solinit1.x,solinit1.y(1,1:end)+wv1(solinit1.x,pars),'-k')
%plot(solinit1.x,solinit1.y(2,1:end)+wth1(solinit1.x,pars),'-m')
legend('V_{num}','q_{num}','V_{lin}','q_{lin}')
%legend('V_{num}','q_{num}','V_{lin}','q_{lin}','V_{LS}','q_{LS}')
grid on
grid MINOR

subplot(2,2,2)
title('Mode 2 (\beta>0)')
hold on
plot(sol2.x,sol2.y(1,1:end),'-.r')
plot(sol2.x,sol2.y(2,1:end),'-.b')
plot(solinit2.x,solinit2.y(1,1:end),'-r')
plot(solinit2.x,solinit2.y(2,1:end),'-b')
%plot(solinit2.x,solinit2.y(1,1:end)+wv2(solinit2.x,pars),'-k')
%plot(solinit2.x,solinit2.y(2,1:end)+wth2(solinit2.x,pars),'-m')

grid on
grid MINOR

subplot(2,2,3)
title('Mode 1 (\alpha<0)')
hold on
plot(sol3.x,sol3.y(1,1:end),'-.r')
plot(sol3.x,sol3.y(2,1:end),'-.b')
plot(solinit3.x,solinit3.y(1,1:end),'-r')
plot(solinit3.x,solinit3.y(2,1:end),'-b')
%plot(solinit3.x,solinit3.y(1,1:end)+wv3(solinit3.x,pars),'-k')
%plot(solinit3.x,solinit3.y(2,1:end)+wth3(solinit3.x,pars),'-m')

grid on
grid MINOR

subplot(2,2,4)
title('Mode 2 (\beta<0)')
hold on
plot(sol4.x,sol4.y(1,1:end),'-. r')
plot(sol4.x,sol4.y(2,1:end),'-. b')
plot(solinit4.x,solinit4.y(1,1:end),'-r')
plot(solinit4.x,solinit4.y(2,1:end),'-b')
%plot(solinit4.x,solinit4.y(1,1:end)+wv4(solinit4.x,pars),'-k')
%plot(solinit4.x,solinit4.y(2,1:end)+wth4(solinit4.x,pars),'-m')

grid on
grid MINOR

set(findall(gcf,'-property','FontSize'),'FontSize',20)
set(findall(gcf,'-property','LineWidth'),'LineWidth',2.5)
set(findall(gcf,'-property','MarkerSize'),'MarkerSize',6)


figure()

title('Mode 5 (pos)')
hold on
plot(sol5.x,sol5.y(1,1:end),'-. r')
plot(sol5.x,sol5.y(2,1:end),'-. b')
plot(solinit5.x,solinit5.y(1,1:end),'-r')
plot(solinit5.x,solinit5.y(2,1:end),'-b')
legend('V','q','Vex','qex')
grid on
grid MINOR
set(findall(gcf,'-property','FontSize'),'FontSize',20)
set(findall(gcf,'-property','LineWidth'),'LineWidth',2.5)
set(findall(gcf,'-property','MarkerSize'),'MarkerSize',6)

%}
%% Error mode 1
err_v = sum((solinit1.y(1,1:end)-sol1.y(1,1:end)).^2)/length(sol1.x)+...
           sum((solinit3.y(1,1:end)-sol3.y(1,1:end)).^2)/length(sol3.x);

err_v_ls = sum((solinit1.y(1,1:end)+wv1(solinit1.x,pars)-sol1.y(1,1:end)).^2)/length(sol1.x)+...
    sum((solinit3.y(1,1:end)+wv3(solinit3.x,pars)-sol3.y(1,1:end)).^2)/length(sol3.x);
    
err_th =sum((solinit1.y(2,1:end)-sol1.y(2,1:end)).^2)/length(sol1.x)+...
           sum((solinit3.y(2,1:end)-sol3.y(2,1:end)).^2)/length(sol3.x);

err_th_ls =sum((solinit1.y(2,1:end)+wth1(solinit1.x,pars)-sol1.y(2,1:end)).^2)/length(sol1.x)+...
    sum((solinit3.y(2,1:end)+wth3(solinit3.x,pars)-sol3.y(2,1:end)).^2)/length(sol3.x);
E_mod_1=[err_v,err_v_ls,err_th,err_th_ls];

%% Error mode 2  

err_v= sum((solinit2.y(1,1:end)-sol2.y(1,1:end)).^2)/length(sol2.x)+...
           sum((solinit4.y(1,1:end)-sol4.y(1,1:end)).^2)/length(sol4.x);

err_v_ls = sum((solinit2.y(1,1:end)+wv2(solinit2.x,pars)-sol2.y(1,1:end)).^2)/length(sol2.x)+...
    sum((solinit4.y(1,1:end)+wv4(solinit4.x,pars)-sol4.y(1,1:end)).^2)/length(sol4.x);

err_th= sum((solinit2.y(2,1:end)-sol2.y(2,1:end)).^2)/length(sol2.x)+...
           sum((solinit4.y(2,1:end)-sol4.y(2,1:end)).^2)/length(sol4.x);

err_th_ls =sum((solinit2.y(2,1:end)+wth2(solinit2.x,pars)-sol2.y(2,1:end)).^2)/length(sol2.x)+...
    sum((solinit4.y(2,1:end)+wth4(solinit4.x,pars)-sol4.y(2,1:end)).^2)/length(sol4.x);

E_mod_2=[err_v,err_v_ls,err_th,err_th_ls];
%% Total error

err_v= sum((solinit1.y(1,1:end)-sol1.y(1,1:end)).^2)/length(sol1.x)+...
           sum((solinit2.y(1,1:end)-sol2.y(1,1:end)).^2)/length(sol2.x)+...
           sum((solinit3.y(1,1:end)-sol3.y(1,1:end)).^2)/length(sol3.x)+...
           sum((solinit4.y(1,1:end)-sol4.y(1,1:end)).^2)/length(sol4.x);

err_v_ls = sum((solinit1.y(1,1:end)+wv1(solinit1.x,pars)-sol1.y(1,1:end)).^2)/length(sol1.x)+...
    sum((solinit2.y(1,1:end)+wv2(solinit2.x,pars)-sol2.y(1,1:end)).^2)/length(sol2.x)+...
    sum((solinit3.y(1,1:end)+wv3(solinit3.x,pars)-sol3.y(1,1:end)).^2)/length(sol3.x)+...
    sum((solinit4.y(1,1:end)+wv4(solinit4.x,pars)-sol4.y(1,1:end)).^2)/length(sol4.x);

err_th=sum((solinit1.y(2,1:end)-sol1.y(2,1:end)).^2)/length(sol1.x)+...
           sum((solinit2.y(2,1:end)-sol2.y(2,1:end)).^2)/length(sol2.x)+...
           sum((solinit3.y(2,1:end)-sol3.y(2,1:end)).^2)/length(sol3.x)+...
           sum((solinit4.y(2,1:end)-sol4.y(2,1:end)).^2)/length(sol4.x);

err_th_ls =sum((solinit1.y(2,1:end)+wth1(solinit1.x,pars)-sol1.y(2,1:end)).^2)/length(sol1.x)+...
    sum((solinit2.y(2,1:end)+wth2(solinit2.x,pars)-sol2.y(2,1:end)).^2)/length(sol2.x)+...
    sum((solinit3.y(2,1:end)+wth3(solinit3.x,pars)-sol3.y(2,1:end)).^2)/length(sol3.x)+...
    sum((solinit4.y(2,1:end)+wth4(solinit4.x,pars)-sol4.y(2,1:end)).^2)/length(sol4.x);
E_tot=[err_v,err_v_ls,err_th,err_th_ls];
%%
fprintf('**************************************************************\n')
fprintf('Mode, Err velocity, Err velocity LS, Err director, Err director LS\n')
fprintf('**************************************************************\n')
fprintf('1: '),fprintf(num2str(E_mod_1)),fprintf('\n')
fprintf('**************************************************************\n')
fprintf('2: '),fprintf(num2str(E_mod_2)),fprintf('\n')
fprintf('**************************************************************\n')
fprintf('Tot: '),fprintf(num2str(E_tot)),fprintf('\n')
fprintf('**************************************************************\n')

%% Equations alpha = 1.05, 1.1 1.25 1.4

function dydx = bvpfcn(x,y) % equation to solve
alpha=1.2247;
a0 =2.5;
mu=1;
zeta=0.5;
L=1;
k=((a0^3-1)^2*L^2*mu*zeta)/(4*pi^2*a0*alpha^2);
r=mu*L^2/k;


%% Intermediate functions:

f1 = @(q,vprime) (4*(a0^3-1)*(2*vprime*sin(2*q)*...
    ((a0^3-1)*cos(2*q)+a0^3+1)-2*a0*zeta*cos(2*q)));

f2 = @(q) (4*(a0^6-1)*cos(2*q)-5*a0^6+(a0^3-1)^2*cos(4*q)+2*a0^3-5);

g =  @(q) ((1-a0^3)/(2*a0^2)*r*((a0^3+1)*cos(2*q)-a0^3+1));

dydx = [y(3)
       y(4)
       y(4)*f1(y(2),y(3))/f2(y(2))
       y(3)*g(y(2))];
end
%--------------------------------
function res = bcfcn(ya,yb) % boundary conditions
res = [ya(1)
       ya(2)
       yb(1)
       yb(2)];
end
%--------------------------------
function g = guess1(x) % initial guess for y and y'
alpha=1.2247;
lambda=alpha^2-1;
a0 =2.5;
mu=1;
zeta=0.5;
L=1;
k=((a0^3-1)^2*L^2*mu*zeta)/(4*pi^2*a0*alpha^2);
r=mu*L^2/k;

al=4*a0^2*pi*sqrt(lambda)/r/sqrt(6*a0^12-15*a0^9+...
    17*a0^6-13*a0^3+5);
be=4*a0^2*pi*sqrt(lambda)/r/sqrt(14*a0^12-27*a0^9+...
    37*a0^6-49*a0^3+25);
bb=(a0^3-1)*r/(2*pi*a0^2);

g = al*[1-cos(2*pi*x)
     bb*sin(2*pi*x)
     2*pi*sin(2*pi*x)
     bb*2*pi*cos(2*pi*x)];
end

function g = guess2(x) % initial guess for y and y'
alpha=1.2247;
lambda=alpha^2-1;
a0 =2.5;
mu=1;
zeta=0.5;
L=1;
k=((a0^3-1)^2*L^2*mu*zeta)/(4*pi^2*a0*alpha^2);
r=mu*L^2/k;

al=4*a0^2*pi*sqrt(lambda)/r/sqrt(6*a0^12-15*a0^9+...
    17*a0^6-13*a0^3+5);
be=4*a0^2*pi*sqrt(lambda)/r/sqrt(14*a0^12-27*a0^9+...
    37*a0^6-49*a0^3+25);
bb=(a0^3-1)*r/(2*pi*a0^2);

g = be*[sin(2*pi*x)
    bb*(cos(2*pi*x)-1)
     2*pi*cos(2*pi*x)
     -2*bb*pi*sin(2*pi*x)];
end

function g = guess3(x) % initial guess for y and y'
alpha=1.2247;
a0 =2.5;
mu=1;
zeta=0.5;
lambda=alpha^2-1;
L=1;
k=((a0^3-1)^2*L^2*mu*zeta)/(4*pi^2*a0*alpha^2);
r=mu*L^2/k;
bb=(a0^3-1)*r/(2*pi*a0^2);

al=4*a0^2*pi*sqrt(lambda)/r/sqrt(6*a0^12-15*a0^9+...
    17*a0^6-13*a0^3+5);
be=4*a0^2*pi*sqrt(lambda)/r/sqrt(14*a0^12-27*a0^9+...
    37*a0^6-49*a0^3+25);
g = al*[-1+cos(2*pi*x)
    - bb*sin(2*pi*x)
    - 2*pi*sin(2*pi*x)
    - 2*bb*pi*cos(2*pi*x)];
end

function g = guess4(x) % initial guess for y and y'
alpha=1.2247;
lambda=alpha^2-1;
a0 =2.5;
mu=1;
zeta=0.5;
L=1;
k=((a0^3-1)^2*L^2*mu*zeta)/(4*pi^2*a0*alpha^2);
r=mu*L^2/k;
bb=(a0^3-1)*r/(2*pi*a0^2);

al=4*a0^2*pi*sqrt(lambda)/r/sqrt(6*a0^12-15*a0^9+...
    17*a0^6-13*a0^3+5);
be=4*a0^2*pi*sqrt(lambda)/r/sqrt(14*a0^12-27*a0^9+...
    37*a0^6-49*a0^3+25);
g = -be*[sin(2*pi*x) 
    bb*(cos(2*pi*x)-1)
     2*pi*cos(2*pi*x)
    -2*bb*pi*sin(2*pi*x)];
end

%--------------------------------

function wv = wv1(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=0;
al=pars.al;
r=pars.r;

wv=(1/384).*pi.^(-2).*(48.*a0.^12.*pi.^4+40.*a0.^8.*((-1)+a0.^3).^2.* ...
  pi.^2.*r.^2+3.*((-1).*a0+a0.^4).^4.*r.^4).^(-1).*((-1).*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(8.*a0.^16.*pi.^2.*r.^2.*( ...
  45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+2.*a0.^18.* ...
  r.^4.*(45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+(-384).* ...
  a0.^8.*pi.^4.*(3.*al+2.*pi.*be).*lambda+3.*a0.^12.*r.^4.*(329.*al.^3+261.* ...
  al.*be.^2+4.*pi.*al.^2.*be.*(53+(-48).*x)+12.*pi.*be.^3.*(43+(-16).*x)) ...
  +(-1).*a0.^15.*r.^4.*(469.*al.^3+321.*al.*be.^2+12.*pi.*al.^2.*be.*(27+ ...
  (-16).*x)+12.*pi.*be.^3.*(63+(-16).*x))+(-2).*a0.^9.*r.^4.*(529.* ...
  al.^3+461.*al.*be.^2+12.*pi.*al.^2.*be.*(31+(-16).*x)+12.*pi.*be.^3.*( ...
  83+(-16).*x))+16.*a0.^6.*r.^4.*(37.*al.^3+33.*al.*be.^2+12.*pi.* ...
  al.^2.*be.*(3+2.*x)+12.*pi.*be.^3.*(9+2.*x))+r.^4.*(11.*al.^3+(-1).* ...
  al.*be.^2+12.*pi.*al.^2.*be.*(5+16.*x)+12.*pi.*be.^3.*(17+16.*x))+4.* ...
  a0.^13.*pi.^2.*r.^2.*((-217).*al.^3+(-53).*al.*be.^2+36.*pi.*be.^3.*(( ...
  -17)+16.*x)+12.*pi.*al.^2.*be.*((-31)+48.*x))+(-3).*a0.^3.*r.^4.*( ...
  51.*al.^3+39.*al.*be.^2+12.*pi.*be.^3.*(25+16.*x)+4.*pi.*al.^2.*be.*(23+ ...
  48.*x))+4.*a0.^4.*pi.^2.*r.^2.*(83.*al.^3+al.*(167.*be.^2+(-72).*lambda)+ ...
  12.*pi.*al.^2.*be.*((-11)+48.*x)+12.*pi.*be.*(be.^2+(-4).*lambda+48.*be.^2.* ...
  x))+(-4).*a0.^10.*pi.^2.*r.^2.*((-247).*al.^3+al.*((-123).*be.^2+72.* ...
  lambda)+36.*pi.*al.^2.*be.*((-11)+16.*x)+12.*pi.*be.*(4.*lambda+be.^2.*((-61)+ ...
  48.*x)))+(-4).*a0.^7.*pi.^2.*r.^2.*(203.*al.^3+al.*(287.*be.^2+(-144) ...
  .*lambda)+36.*pi.*al.^2.*be.*((-1)+16.*x)+12.*pi.*be.*((-8).*lambda+be.^2.*(25+ ...
  48.*x))))+2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(6.* ...
  a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(3.*al+2.*pi.*be.*(1+(-2).*x))+(-3) ...
  .*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(31.*al+18.*pi.*be.*(1+(-2).*x))+ ...
  3.*r.^4.*(3.*al.^3+23.*al.*be.^2+10.*pi.*al.^2.*be.*(1+(-2).*x)+34.* ...
  pi.*be.^3.*(1+(-2).*x))+24.*a0.^6.*r.^4.*(15.*al.^3+47.*al.*be.^2+12.* ...
  pi.*al.^2.*be.*(1+(-2).*x)+36.*pi.*be.^3.*(1+(-2).*x))+(-3).*a0.^3.* ...
  r.^4.*(33.*al.^3+141.*al.*be.^2+46.*pi.*al.^2.*be.*(1+(-2).*x)+150.* ...
  pi.*be.^3.*(1+(-2).*x))+(-6).*a0.^9.*r.^4.*(105.*al.^3+277.*al.*be.^2+ ...
  62.*pi.*al.^2.*be.*(1+(-2).*x)+166.*pi.*be.^3.*(1+(-2).*x))+3.* ...
  a0.^12.*r.^4.*(195.*al.^3+471.*al.*be.^2+106.*pi.*al.^2.*be.*(1+(-2).* ...
  x)+258.*pi.*be.^3.*(1+(-2).*x))+192.*a0.^8.*pi.^4.*lambda.*((-3).*al+2.* ...
  pi.*be.*((-1)+6.*x))+(-16).*a0.^16.*pi.^2.*r.^2.*((-18).*al.^3+(-82) ...
  .*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+21.*pi.*be.^3.*((-1)+6.*x))+ ...
  8.*a0.^13.*pi.^2.*r.^2.*((-94).*al.^3+(-446).*al.*be.^2+9.*pi.*be.^3.* ...
  ((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x))+(-8).*a0.^4.*pi.^2.* ...
  r.^2.*((-26).*al.^3+2.*al.*((-73).*be.^2+9.*lambda)+3.*pi.*al.^2.*be.*(11+ ...
  30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+102.*x)))+8.*a0.^7.* ...
  pi.^2.*r.^2.*((-74).*al.^3+al.*((-410).*be.^2+36.*lambda)+9.*pi.*al.^2.*be.* ...
  (1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+be.^2.*((-25)+246.*x)))+(-8) ...
  .*a0.^10.*pi.^2.*r.^2.*((-106).*al.^3+6.*al.*((-91).*be.^2+3.*lambda)+9.* ...
  pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-61) ...
  +270.*x)))).*cos(2.*pi.*x)+(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*((-32).*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*( ...
  4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*be.^2.*cos(4.*pi.*x)+ ...
  (-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*(al.^2+(-3).*be.^2).*cos( ...
  6.*pi.*x)+4.*((-12).*a0.^16.*pi.^2.*r.^2.*(3.*al.^2+7.*be.^2).*(be+ ...
  2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.*pi.^4.*lambda.*(be+2.*pi.*al.*((-1)+2.* ...
  x))+6.*a0.^13.*pi.^2.*r.^2.*((-17).*al.^2.*be+3.*be.^3+10.*pi.*al.*( ...
  3.*al.^2+7.*be.^2).*((-1)+2.*x))+(-12).*a0.^6.*r.^4.*(27.*al.^2.*be+ ...
  163.*be.^3+12.*pi.*al.*(al.^2+3.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.* ...
  r.^4.*(29.*al.^2.*be+109.*be.^3+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  6.*x))+9.*a0.^15.*r.^4.*(35.*al.^2.*be+123.*be.^3+3.*pi.*al.*(3.*al.^2+ ...
  7.*be.^2).*((-1)+6.*x))+r.^4.*(11.*al.^2.*be+(-133).*be.^3+(-3).*pi.* ...
  al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+a0.^3.*r.^4.*(39.*al.^2.*be+ ...
  767.*be.^3+3.*pi.*al.*(23.*al.^2+75.*be.^2).*((-1)+6.*x))+2.*a0.^9.* ...
  r.^4.*(7.*be.*(49.*al.^2+201.*be.^2)+3.*pi.*al.*(31.*al.^2+83.*be.^2).*( ...
  (-1)+6.*x))+(-1).*a0.^12.*r.^4.*(669.*al.^2.*be+2381.*be.^3+3.*pi.* ...
  al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+(-6).*a0.^4.*pi.^2.*r.^2.*( ...
  be.*(37.*al.^2+49.*be.^2+(-36).*lambda)+2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+5.* ...
  al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x)))+6.*a0.^7.*pi.^2.*r.^2.*( ...
  be.*(45.*al.^2+73.*be.^2+(-72).*lambda)+2.*pi.*al.*(8.*lambda.*(1+(-6).*x)+13.* ...
  al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)))+(-6).*a0.^10.*pi.^2.* ...
  r.^2.*((-15).*al.^2.*be+13.*be.^3+(-36).*be.*lambda+2.*pi.*al.*(4.*lambda.*(1+( ...
  -6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1)+2.*x)))).*sin(2.* ...
  pi.*x)+16.*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*sin( ...
  4.*pi.*x)+(-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).* ...
  r.^2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+ ...
  be.^2).*sin(6.*pi.*x)));
end
function wth=wth1(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=0;
al=pars.al;
r=pars.r;

wth=(1/768).*((-1)+a0).*a0.^(-6).*(1+a0+a0.^2).*pi.^(-3).*r.*(48.* ...
  a0.^8.*pi.^4+40.*a0.^4.*((-1)+a0.^3).^2.*pi.^2.*r.^2+3.*((-1)+ ...
  a0.^3).^4.*r.^4).^(-1).*((-1).*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*(a0.^12.*r.^4.*(636.*pi.*al.^3+(-1371).*al.^2.*be+1548.*pi.* ...
  al.*be.^2+(-1799).*be.^3)+r.^4.*(60.*pi.*al.^3+(-139).*al.^2.*be+204.* ...
  pi.*al.*be.^2+(-247).*be.^3)+(-9).*a0.^15.*r.^4.*(36.*pi.*al.^3+(-77) ...
  .*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+2.*a0.^18.*r.^4.*(36.*pi.* ...
  al.^3+(-77).*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+8.*a0.^16.* ...
  pi.^2.*r.^2.*(36.*pi.*al.^3+(-5).*al.^2.*be+84.*pi.*al.*be.^2+71.*be.^3) ...
  +48.*a0.^6.*r.^4.*((-27).*al.^2.*be+(-43).*be.^3+12.*pi.*(al.^3+3.*al.* ...
  be.^2))+(-4).*a0.^13.*pi.^2.*r.^2.*(239.*al.^2.*be+715.*be.^3+60.*pi.* ...
  (3.*al.^3+7.*al.*be.^2))+a0.^3.*r.^4.*(633.*al.^2.*be+1085.*be.^3+(-12) ...
  .*pi.*(23.*al.^3+75.*al.*be.^2))+2.*a0.^9.*r.^4.*(817.*al.^2.*be+1173.* ...
  be.^3+(-12).*pi.*(31.*al.^3+83.*al.*be.^2))+(-384).*a0.^8.*pi.^4.*(2.* ...
  pi.*al+be).*lambda+4.*a0.^4.*pi.^2.*r.^2.*((-283).*al.^2.*be+(-199).*be.^3+ ...
  12.*pi.*al.*(5.*al.^2+17.*be.^2+(-4).*lambda)+72.*be.*lambda)+(-4).*a0.^7.* ...
  pi.^2.*r.^2.*((-307).*al.^2.*be+33.*be.^3+12.*pi.*al.*(13.*al.^2+41.* ...
  be.^2+(-8).*lambda)+144.*be.*lambda)+4.*a0.^10.*pi.^2.*r.^2.*(12.*pi.*al.*(17.* ...
  al.^2+45.*be.^2+(-4).*lambda)+be.*(225.*al.^2+805.*be.^2+72.*lambda)))+4.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*((-12).*a0.^16.*pi.^2.*r.^2.* ...
  (3.*al.^2+7.*be.^2).*((-1).*be+2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.* ...
  pi.^4.*lambda.*((-1).*be+2.*pi.*al.*((-1)+2.*x))+6.*a0.^13.*pi.^2.*r.^2.* ...
  ((-59).*al.^2.*be+(-95).*be.^3+10.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  2.*x))+(-48).*a0.^6.*r.^4.*(19.*be.^3+3.*pi.*al.*(al.^2+3.*be.^2).*(( ...
  -1)+6.*x))+9.*a0.^15.*r.^4.*(2.*be.*(al.^2+23.*be.^2)+3.*pi.*al.*(3.* ...
  al.^2+7.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.*r.^4.*(2.*be.*(al.^2+23.* ...
  be.^2)+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+6.*x))+r.^4.*(2.*be.*( ...
  al.^2+(-53).*be.^2)+(-3).*pi.*al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+ ...
  a0.^3.*r.^4.*((-6).*al.^2.*be+470.*be.^3+3.*pi.*al.*(23.*al.^2+75.* ...
  be.^2).*((-1)+6.*x))+2.*a0.^9.*r.^4.*(10.*al.^2.*be+534.*be.^3+3.*pi.* ...
  al.*(31.*al.^2+83.*be.^2).*((-1)+6.*x))+(-1).*a0.^12.*r.^4.*(30.* ...
  al.^2.*be+842.*be.^3+3.*pi.*al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+( ...
  -6).*a0.^4.*pi.^2.*r.^2.*(be.*(39.*al.^2+43.*be.^2+(-12).*lambda)+2.*pi.* ...
  al.*(4.*lambda.*(1+(-6).*x)+5.*al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x))) ...
  +6.*a0.^7.*pi.^2.*r.^2.*(be.*(31.*al.^2+19.*be.^2+(-24).*lambda)+2.*pi.* ...
  al.*(8.*lambda.*(1+(-6).*x)+13.*al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)) ...
  )+(-6).*a0.^10.*pi.^2.*r.^2.*((-1).*be.*(61.*al.^2+105.*be.^2+12.*lambda)+ ...
  2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1) ...
  +2.*x)))).*cos(2.*pi.*x)+(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.* ...
  r.^2).*(32.*((-1)+a0.^3).^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*cos(4.* ...
  pi.*x)+(-1).*((-1)+a0.^3).^2.*(5+(-3).*a0.^3+6.*a0.^6).*r.^2.*( ...
  12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+be.^2).* ...
  cos(6.*pi.*x)+(-2).*(144.*a0.^6.*r.^4.*(al.^2+3.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+(-27).*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+6.*a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.*be.*( ...
  1+(-2).*x))+3.*r.^4.*(5.*al.^2+17.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-3).*a0.^3.*r.^4.*(23.*al.^2+75.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-6).*a0.^9.*r.^4.*(31.*al.^2+83.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +3.*a0.^12.*r.^4.*(53.*al.^2+129.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x))+ ...
  192.*a0.^8.*pi.^4.*lambda.*(3.*al+2.*pi.*be.*((-1)+6.*x))+(-16).*a0.^16.* ...
  pi.^2.*r.^2.*(9.*al.^3+(-19).*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+ ...
  21.*pi.*be.^3.*((-1)+6.*x))+8.*a0.^13.*pi.^2.*r.^2.*(95.*al.^3+(-5) ...
  .*al.*be.^2+9.*pi.*be.^3.*((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x) ...
  )+(-8).*a0.^4.*pi.^2.*r.^2.*((-35).*al.^3+al.*((-119).*be.^2+6.*lambda)+ ...
  3.*pi.*al.^2.*be.*(11+30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+ ...
  102.*x)))+8.*a0.^7.*pi.^2.*r.^2.*((-11).*al.^3+al.*((-167).*be.^2+ ...
  12.*lambda)+9.*pi.*al.^2.*be.*(1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+ ...
  be.^2.*((-25)+246.*x)))+(-8).*a0.^10.*pi.^2.*r.^2.*(101.*al.^3+al.*(( ...
  -15).*be.^2+6.*lambda)+9.*pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+( ...
  -8).*lambda.*x+be.^2.*((-61)+270.*x)))).*sin(2.*pi.*x)+64.*((-1)+a0.^3) ...
  .^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+ ...
  a0.^3).^2.*r.^2).*al.*be.^2.*sin(4.*pi.*x)+((-1)+a0.^3).^2.*(5+(-3) ...
  .*a0.^3+6.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2) ...
  .*al.*(al.^2+(-3).*be.^2).*sin(6.*pi.*x)));

end

function wv = wv2(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=pars.be;
al=0;
r=pars.r;

wv=(1/384).*pi.^(-2).*(48.*a0.^12.*pi.^4+40.*a0.^8.*((-1)+a0.^3).^2.* ...
  pi.^2.*r.^2+3.*((-1).*a0+a0.^4).^4.*r.^4).^(-1).*((-1).*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(8.*a0.^16.*pi.^2.*r.^2.*( ...
  45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+2.*a0.^18.* ...
  r.^4.*(45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+(-384).* ...
  a0.^8.*pi.^4.*(3.*al+2.*pi.*be).*lambda+3.*a0.^12.*r.^4.*(329.*al.^3+261.* ...
  al.*be.^2+4.*pi.*al.^2.*be.*(53+(-48).*x)+12.*pi.*be.^3.*(43+(-16).*x)) ...
  +(-1).*a0.^15.*r.^4.*(469.*al.^3+321.*al.*be.^2+12.*pi.*al.^2.*be.*(27+ ...
  (-16).*x)+12.*pi.*be.^3.*(63+(-16).*x))+(-2).*a0.^9.*r.^4.*(529.* ...
  al.^3+461.*al.*be.^2+12.*pi.*al.^2.*be.*(31+(-16).*x)+12.*pi.*be.^3.*( ...
  83+(-16).*x))+16.*a0.^6.*r.^4.*(37.*al.^3+33.*al.*be.^2+12.*pi.* ...
  al.^2.*be.*(3+2.*x)+12.*pi.*be.^3.*(9+2.*x))+r.^4.*(11.*al.^3+(-1).* ...
  al.*be.^2+12.*pi.*al.^2.*be.*(5+16.*x)+12.*pi.*be.^3.*(17+16.*x))+4.* ...
  a0.^13.*pi.^2.*r.^2.*((-217).*al.^3+(-53).*al.*be.^2+36.*pi.*be.^3.*(( ...
  -17)+16.*x)+12.*pi.*al.^2.*be.*((-31)+48.*x))+(-3).*a0.^3.*r.^4.*( ...
  51.*al.^3+39.*al.*be.^2+12.*pi.*be.^3.*(25+16.*x)+4.*pi.*al.^2.*be.*(23+ ...
  48.*x))+4.*a0.^4.*pi.^2.*r.^2.*(83.*al.^3+al.*(167.*be.^2+(-72).*lambda)+ ...
  12.*pi.*al.^2.*be.*((-11)+48.*x)+12.*pi.*be.*(be.^2+(-4).*lambda+48.*be.^2.* ...
  x))+(-4).*a0.^10.*pi.^2.*r.^2.*((-247).*al.^3+al.*((-123).*be.^2+72.* ...
  lambda)+36.*pi.*al.^2.*be.*((-11)+16.*x)+12.*pi.*be.*(4.*lambda+be.^2.*((-61)+ ...
  48.*x)))+(-4).*a0.^7.*pi.^2.*r.^2.*(203.*al.^3+al.*(287.*be.^2+(-144) ...
  .*lambda)+36.*pi.*al.^2.*be.*((-1)+16.*x)+12.*pi.*be.*((-8).*lambda+be.^2.*(25+ ...
  48.*x))))+2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(6.* ...
  a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(3.*al+2.*pi.*be.*(1+(-2).*x))+(-3) ...
  .*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(31.*al+18.*pi.*be.*(1+(-2).*x))+ ...
  3.*r.^4.*(3.*al.^3+23.*al.*be.^2+10.*pi.*al.^2.*be.*(1+(-2).*x)+34.* ...
  pi.*be.^3.*(1+(-2).*x))+24.*a0.^6.*r.^4.*(15.*al.^3+47.*al.*be.^2+12.* ...
  pi.*al.^2.*be.*(1+(-2).*x)+36.*pi.*be.^3.*(1+(-2).*x))+(-3).*a0.^3.* ...
  r.^4.*(33.*al.^3+141.*al.*be.^2+46.*pi.*al.^2.*be.*(1+(-2).*x)+150.* ...
  pi.*be.^3.*(1+(-2).*x))+(-6).*a0.^9.*r.^4.*(105.*al.^3+277.*al.*be.^2+ ...
  62.*pi.*al.^2.*be.*(1+(-2).*x)+166.*pi.*be.^3.*(1+(-2).*x))+3.* ...
  a0.^12.*r.^4.*(195.*al.^3+471.*al.*be.^2+106.*pi.*al.^2.*be.*(1+(-2).* ...
  x)+258.*pi.*be.^3.*(1+(-2).*x))+192.*a0.^8.*pi.^4.*lambda.*((-3).*al+2.* ...
  pi.*be.*((-1)+6.*x))+(-16).*a0.^16.*pi.^2.*r.^2.*((-18).*al.^3+(-82) ...
  .*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+21.*pi.*be.^3.*((-1)+6.*x))+ ...
  8.*a0.^13.*pi.^2.*r.^2.*((-94).*al.^3+(-446).*al.*be.^2+9.*pi.*be.^3.* ...
  ((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x))+(-8).*a0.^4.*pi.^2.* ...
  r.^2.*((-26).*al.^3+2.*al.*((-73).*be.^2+9.*lambda)+3.*pi.*al.^2.*be.*(11+ ...
  30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+102.*x)))+8.*a0.^7.* ...
  pi.^2.*r.^2.*((-74).*al.^3+al.*((-410).*be.^2+36.*lambda)+9.*pi.*al.^2.*be.* ...
  (1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+be.^2.*((-25)+246.*x)))+(-8) ...
  .*a0.^10.*pi.^2.*r.^2.*((-106).*al.^3+6.*al.*((-91).*be.^2+3.*lambda)+9.* ...
  pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-61) ...
  +270.*x)))).*cos(2.*pi.*x)+(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*((-32).*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*( ...
  4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*be.^2.*cos(4.*pi.*x)+ ...
  (-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*(al.^2+(-3).*be.^2).*cos( ...
  6.*pi.*x)+4.*((-12).*a0.^16.*pi.^2.*r.^2.*(3.*al.^2+7.*be.^2).*(be+ ...
  2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.*pi.^4.*lambda.*(be+2.*pi.*al.*((-1)+2.* ...
  x))+6.*a0.^13.*pi.^2.*r.^2.*((-17).*al.^2.*be+3.*be.^3+10.*pi.*al.*( ...
  3.*al.^2+7.*be.^2).*((-1)+2.*x))+(-12).*a0.^6.*r.^4.*(27.*al.^2.*be+ ...
  163.*be.^3+12.*pi.*al.*(al.^2+3.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.* ...
  r.^4.*(29.*al.^2.*be+109.*be.^3+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  6.*x))+9.*a0.^15.*r.^4.*(35.*al.^2.*be+123.*be.^3+3.*pi.*al.*(3.*al.^2+ ...
  7.*be.^2).*((-1)+6.*x))+r.^4.*(11.*al.^2.*be+(-133).*be.^3+(-3).*pi.* ...
  al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+a0.^3.*r.^4.*(39.*al.^2.*be+ ...
  767.*be.^3+3.*pi.*al.*(23.*al.^2+75.*be.^2).*((-1)+6.*x))+2.*a0.^9.* ...
  r.^4.*(7.*be.*(49.*al.^2+201.*be.^2)+3.*pi.*al.*(31.*al.^2+83.*be.^2).*( ...
  (-1)+6.*x))+(-1).*a0.^12.*r.^4.*(669.*al.^2.*be+2381.*be.^3+3.*pi.* ...
  al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+(-6).*a0.^4.*pi.^2.*r.^2.*( ...
  be.*(37.*al.^2+49.*be.^2+(-36).*lambda)+2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+5.* ...
  al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x)))+6.*a0.^7.*pi.^2.*r.^2.*( ...
  be.*(45.*al.^2+73.*be.^2+(-72).*lambda)+2.*pi.*al.*(8.*lambda.*(1+(-6).*x)+13.* ...
  al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)))+(-6).*a0.^10.*pi.^2.* ...
  r.^2.*((-15).*al.^2.*be+13.*be.^3+(-36).*be.*lambda+2.*pi.*al.*(4.*lambda.*(1+( ...
  -6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1)+2.*x)))).*sin(2.* ...
  pi.*x)+16.*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*sin( ...
  4.*pi.*x)+(-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).* ...
  r.^2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+ ...
  be.^2).*sin(6.*pi.*x)));
end
function wth=wth2(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=pars.be;
al=0;
r=pars.r;

wth=(1/768).*((-1)+a0).*a0.^(-6).*(1+a0+a0.^2).*pi.^(-3).*r.*(48.* ...
  a0.^8.*pi.^4+40.*a0.^4.*((-1)+a0.^3).^2.*pi.^2.*r.^2+3.*((-1)+ ...
  a0.^3).^4.*r.^4).^(-1).*((-1).*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*(a0.^12.*r.^4.*(636.*pi.*al.^3+(-1371).*al.^2.*be+1548.*pi.* ...
  al.*be.^2+(-1799).*be.^3)+r.^4.*(60.*pi.*al.^3+(-139).*al.^2.*be+204.* ...
  pi.*al.*be.^2+(-247).*be.^3)+(-9).*a0.^15.*r.^4.*(36.*pi.*al.^3+(-77) ...
  .*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+2.*a0.^18.*r.^4.*(36.*pi.* ...
  al.^3+(-77).*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+8.*a0.^16.* ...
  pi.^2.*r.^2.*(36.*pi.*al.^3+(-5).*al.^2.*be+84.*pi.*al.*be.^2+71.*be.^3) ...
  +48.*a0.^6.*r.^4.*((-27).*al.^2.*be+(-43).*be.^3+12.*pi.*(al.^3+3.*al.* ...
  be.^2))+(-4).*a0.^13.*pi.^2.*r.^2.*(239.*al.^2.*be+715.*be.^3+60.*pi.* ...
  (3.*al.^3+7.*al.*be.^2))+a0.^3.*r.^4.*(633.*al.^2.*be+1085.*be.^3+(-12) ...
  .*pi.*(23.*al.^3+75.*al.*be.^2))+2.*a0.^9.*r.^4.*(817.*al.^2.*be+1173.* ...
  be.^3+(-12).*pi.*(31.*al.^3+83.*al.*be.^2))+(-384).*a0.^8.*pi.^4.*(2.* ...
  pi.*al+be).*lambda+4.*a0.^4.*pi.^2.*r.^2.*((-283).*al.^2.*be+(-199).*be.^3+ ...
  12.*pi.*al.*(5.*al.^2+17.*be.^2+(-4).*lambda)+72.*be.*lambda)+(-4).*a0.^7.* ...
  pi.^2.*r.^2.*((-307).*al.^2.*be+33.*be.^3+12.*pi.*al.*(13.*al.^2+41.* ...
  be.^2+(-8).*lambda)+144.*be.*lambda)+4.*a0.^10.*pi.^2.*r.^2.*(12.*pi.*al.*(17.* ...
  al.^2+45.*be.^2+(-4).*lambda)+be.*(225.*al.^2+805.*be.^2+72.*lambda)))+4.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*((-12).*a0.^16.*pi.^2.*r.^2.* ...
  (3.*al.^2+7.*be.^2).*((-1).*be+2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.* ...
  pi.^4.*lambda.*((-1).*be+2.*pi.*al.*((-1)+2.*x))+6.*a0.^13.*pi.^2.*r.^2.* ...
  ((-59).*al.^2.*be+(-95).*be.^3+10.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  2.*x))+(-48).*a0.^6.*r.^4.*(19.*be.^3+3.*pi.*al.*(al.^2+3.*be.^2).*(( ...
  -1)+6.*x))+9.*a0.^15.*r.^4.*(2.*be.*(al.^2+23.*be.^2)+3.*pi.*al.*(3.* ...
  al.^2+7.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.*r.^4.*(2.*be.*(al.^2+23.* ...
  be.^2)+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+6.*x))+r.^4.*(2.*be.*( ...
  al.^2+(-53).*be.^2)+(-3).*pi.*al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+ ...
  a0.^3.*r.^4.*((-6).*al.^2.*be+470.*be.^3+3.*pi.*al.*(23.*al.^2+75.* ...
  be.^2).*((-1)+6.*x))+2.*a0.^9.*r.^4.*(10.*al.^2.*be+534.*be.^3+3.*pi.* ...
  al.*(31.*al.^2+83.*be.^2).*((-1)+6.*x))+(-1).*a0.^12.*r.^4.*(30.* ...
  al.^2.*be+842.*be.^3+3.*pi.*al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+( ...
  -6).*a0.^4.*pi.^2.*r.^2.*(be.*(39.*al.^2+43.*be.^2+(-12).*lambda)+2.*pi.* ...
  al.*(4.*lambda.*(1+(-6).*x)+5.*al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x))) ...
  +6.*a0.^7.*pi.^2.*r.^2.*(be.*(31.*al.^2+19.*be.^2+(-24).*lambda)+2.*pi.* ...
  al.*(8.*lambda.*(1+(-6).*x)+13.*al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)) ...
  )+(-6).*a0.^10.*pi.^2.*r.^2.*((-1).*be.*(61.*al.^2+105.*be.^2+12.*lambda)+ ...
  2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1) ...
  +2.*x)))).*cos(2.*pi.*x)+(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.* ...
  r.^2).*(32.*((-1)+a0.^3).^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*cos(4.* ...
  pi.*x)+(-1).*((-1)+a0.^3).^2.*(5+(-3).*a0.^3+6.*a0.^6).*r.^2.*( ...
  12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+be.^2).* ...
  cos(6.*pi.*x)+(-2).*(144.*a0.^6.*r.^4.*(al.^2+3.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+(-27).*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+6.*a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.*be.*( ...
  1+(-2).*x))+3.*r.^4.*(5.*al.^2+17.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-3).*a0.^3.*r.^4.*(23.*al.^2+75.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-6).*a0.^9.*r.^4.*(31.*al.^2+83.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +3.*a0.^12.*r.^4.*(53.*al.^2+129.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x))+ ...
  192.*a0.^8.*pi.^4.*lambda.*(3.*al+2.*pi.*be.*((-1)+6.*x))+(-16).*a0.^16.* ...
  pi.^2.*r.^2.*(9.*al.^3+(-19).*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+ ...
  21.*pi.*be.^3.*((-1)+6.*x))+8.*a0.^13.*pi.^2.*r.^2.*(95.*al.^3+(-5) ...
  .*al.*be.^2+9.*pi.*be.^3.*((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x) ...
  )+(-8).*a0.^4.*pi.^2.*r.^2.*((-35).*al.^3+al.*((-119).*be.^2+6.*lambda)+ ...
  3.*pi.*al.^2.*be.*(11+30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+ ...
  102.*x)))+8.*a0.^7.*pi.^2.*r.^2.*((-11).*al.^3+al.*((-167).*be.^2+ ...
  12.*lambda)+9.*pi.*al.^2.*be.*(1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+ ...
  be.^2.*((-25)+246.*x)))+(-8).*a0.^10.*pi.^2.*r.^2.*(101.*al.^3+al.*(( ...
  -15).*be.^2+6.*lambda)+9.*pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+( ...
  -8).*lambda.*x+be.^2.*((-61)+270.*x)))).*sin(2.*pi.*x)+64.*((-1)+a0.^3) ...
  .^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+ ...
  a0.^3).^2.*r.^2).*al.*be.^2.*sin(4.*pi.*x)+((-1)+a0.^3).^2.*(5+(-3) ...
  .*a0.^3+6.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2) ...
  .*al.*(al.^2+(-3).*be.^2).*sin(6.*pi.*x)));

end

function wv = wv3(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=0;
al=-pars.al;
r=pars.r;

wv=(1/384).*pi.^(-2).*(48.*a0.^12.*pi.^4+40.*a0.^8.*((-1)+a0.^3).^2.* ...
  pi.^2.*r.^2+3.*((-1).*a0+a0.^4).^4.*r.^4).^(-1).*((-1).*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(8.*a0.^16.*pi.^2.*r.^2.*( ...
  45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+2.*a0.^18.* ...
  r.^4.*(45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+(-384).* ...
  a0.^8.*pi.^4.*(3.*al+2.*pi.*be).*lambda+3.*a0.^12.*r.^4.*(329.*al.^3+261.* ...
  al.*be.^2+4.*pi.*al.^2.*be.*(53+(-48).*x)+12.*pi.*be.^3.*(43+(-16).*x)) ...
  +(-1).*a0.^15.*r.^4.*(469.*al.^3+321.*al.*be.^2+12.*pi.*al.^2.*be.*(27+ ...
  (-16).*x)+12.*pi.*be.^3.*(63+(-16).*x))+(-2).*a0.^9.*r.^4.*(529.* ...
  al.^3+461.*al.*be.^2+12.*pi.*al.^2.*be.*(31+(-16).*x)+12.*pi.*be.^3.*( ...
  83+(-16).*x))+16.*a0.^6.*r.^4.*(37.*al.^3+33.*al.*be.^2+12.*pi.* ...
  al.^2.*be.*(3+2.*x)+12.*pi.*be.^3.*(9+2.*x))+r.^4.*(11.*al.^3+(-1).* ...
  al.*be.^2+12.*pi.*al.^2.*be.*(5+16.*x)+12.*pi.*be.^3.*(17+16.*x))+4.* ...
  a0.^13.*pi.^2.*r.^2.*((-217).*al.^3+(-53).*al.*be.^2+36.*pi.*be.^3.*(( ...
  -17)+16.*x)+12.*pi.*al.^2.*be.*((-31)+48.*x))+(-3).*a0.^3.*r.^4.*( ...
  51.*al.^3+39.*al.*be.^2+12.*pi.*be.^3.*(25+16.*x)+4.*pi.*al.^2.*be.*(23+ ...
  48.*x))+4.*a0.^4.*pi.^2.*r.^2.*(83.*al.^3+al.*(167.*be.^2+(-72).*lambda)+ ...
  12.*pi.*al.^2.*be.*((-11)+48.*x)+12.*pi.*be.*(be.^2+(-4).*lambda+48.*be.^2.* ...
  x))+(-4).*a0.^10.*pi.^2.*r.^2.*((-247).*al.^3+al.*((-123).*be.^2+72.* ...
  lambda)+36.*pi.*al.^2.*be.*((-11)+16.*x)+12.*pi.*be.*(4.*lambda+be.^2.*((-61)+ ...
  48.*x)))+(-4).*a0.^7.*pi.^2.*r.^2.*(203.*al.^3+al.*(287.*be.^2+(-144) ...
  .*lambda)+36.*pi.*al.^2.*be.*((-1)+16.*x)+12.*pi.*be.*((-8).*lambda+be.^2.*(25+ ...
  48.*x))))+2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(6.* ...
  a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(3.*al+2.*pi.*be.*(1+(-2).*x))+(-3) ...
  .*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(31.*al+18.*pi.*be.*(1+(-2).*x))+ ...
  3.*r.^4.*(3.*al.^3+23.*al.*be.^2+10.*pi.*al.^2.*be.*(1+(-2).*x)+34.* ...
  pi.*be.^3.*(1+(-2).*x))+24.*a0.^6.*r.^4.*(15.*al.^3+47.*al.*be.^2+12.* ...
  pi.*al.^2.*be.*(1+(-2).*x)+36.*pi.*be.^3.*(1+(-2).*x))+(-3).*a0.^3.* ...
  r.^4.*(33.*al.^3+141.*al.*be.^2+46.*pi.*al.^2.*be.*(1+(-2).*x)+150.* ...
  pi.*be.^3.*(1+(-2).*x))+(-6).*a0.^9.*r.^4.*(105.*al.^3+277.*al.*be.^2+ ...
  62.*pi.*al.^2.*be.*(1+(-2).*x)+166.*pi.*be.^3.*(1+(-2).*x))+3.* ...
  a0.^12.*r.^4.*(195.*al.^3+471.*al.*be.^2+106.*pi.*al.^2.*be.*(1+(-2).* ...
  x)+258.*pi.*be.^3.*(1+(-2).*x))+192.*a0.^8.*pi.^4.*lambda.*((-3).*al+2.* ...
  pi.*be.*((-1)+6.*x))+(-16).*a0.^16.*pi.^2.*r.^2.*((-18).*al.^3+(-82) ...
  .*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+21.*pi.*be.^3.*((-1)+6.*x))+ ...
  8.*a0.^13.*pi.^2.*r.^2.*((-94).*al.^3+(-446).*al.*be.^2+9.*pi.*be.^3.* ...
  ((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x))+(-8).*a0.^4.*pi.^2.* ...
  r.^2.*((-26).*al.^3+2.*al.*((-73).*be.^2+9.*lambda)+3.*pi.*al.^2.*be.*(11+ ...
  30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+102.*x)))+8.*a0.^7.* ...
  pi.^2.*r.^2.*((-74).*al.^3+al.*((-410).*be.^2+36.*lambda)+9.*pi.*al.^2.*be.* ...
  (1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+be.^2.*((-25)+246.*x)))+(-8) ...
  .*a0.^10.*pi.^2.*r.^2.*((-106).*al.^3+6.*al.*((-91).*be.^2+3.*lambda)+9.* ...
  pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-61) ...
  +270.*x)))).*cos(2.*pi.*x)+(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*((-32).*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*( ...
  4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*be.^2.*cos(4.*pi.*x)+ ...
  (-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*(al.^2+(-3).*be.^2).*cos( ...
  6.*pi.*x)+4.*((-12).*a0.^16.*pi.^2.*r.^2.*(3.*al.^2+7.*be.^2).*(be+ ...
  2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.*pi.^4.*lambda.*(be+2.*pi.*al.*((-1)+2.* ...
  x))+6.*a0.^13.*pi.^2.*r.^2.*((-17).*al.^2.*be+3.*be.^3+10.*pi.*al.*( ...
  3.*al.^2+7.*be.^2).*((-1)+2.*x))+(-12).*a0.^6.*r.^4.*(27.*al.^2.*be+ ...
  163.*be.^3+12.*pi.*al.*(al.^2+3.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.* ...
  r.^4.*(29.*al.^2.*be+109.*be.^3+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  6.*x))+9.*a0.^15.*r.^4.*(35.*al.^2.*be+123.*be.^3+3.*pi.*al.*(3.*al.^2+ ...
  7.*be.^2).*((-1)+6.*x))+r.^4.*(11.*al.^2.*be+(-133).*be.^3+(-3).*pi.* ...
  al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+a0.^3.*r.^4.*(39.*al.^2.*be+ ...
  767.*be.^3+3.*pi.*al.*(23.*al.^2+75.*be.^2).*((-1)+6.*x))+2.*a0.^9.* ...
  r.^4.*(7.*be.*(49.*al.^2+201.*be.^2)+3.*pi.*al.*(31.*al.^2+83.*be.^2).*( ...
  (-1)+6.*x))+(-1).*a0.^12.*r.^4.*(669.*al.^2.*be+2381.*be.^3+3.*pi.* ...
  al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+(-6).*a0.^4.*pi.^2.*r.^2.*( ...
  be.*(37.*al.^2+49.*be.^2+(-36).*lambda)+2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+5.* ...
  al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x)))+6.*a0.^7.*pi.^2.*r.^2.*( ...
  be.*(45.*al.^2+73.*be.^2+(-72).*lambda)+2.*pi.*al.*(8.*lambda.*(1+(-6).*x)+13.* ...
  al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)))+(-6).*a0.^10.*pi.^2.* ...
  r.^2.*((-15).*al.^2.*be+13.*be.^3+(-36).*be.*lambda+2.*pi.*al.*(4.*lambda.*(1+( ...
  -6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1)+2.*x)))).*sin(2.* ...
  pi.*x)+16.*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*sin( ...
  4.*pi.*x)+(-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).* ...
  r.^2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+ ...
  be.^2).*sin(6.*pi.*x)));
end
function wth=wth3(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=0;
al=-pars.al;
r=pars.r;

wth=(1/768).*((-1)+a0).*a0.^(-6).*(1+a0+a0.^2).*pi.^(-3).*r.*(48.* ...
  a0.^8.*pi.^4+40.*a0.^4.*((-1)+a0.^3).^2.*pi.^2.*r.^2+3.*((-1)+ ...
  a0.^3).^4.*r.^4).^(-1).*((-1).*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*(a0.^12.*r.^4.*(636.*pi.*al.^3+(-1371).*al.^2.*be+1548.*pi.* ...
  al.*be.^2+(-1799).*be.^3)+r.^4.*(60.*pi.*al.^3+(-139).*al.^2.*be+204.* ...
  pi.*al.*be.^2+(-247).*be.^3)+(-9).*a0.^15.*r.^4.*(36.*pi.*al.^3+(-77) ...
  .*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+2.*a0.^18.*r.^4.*(36.*pi.* ...
  al.^3+(-77).*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+8.*a0.^16.* ...
  pi.^2.*r.^2.*(36.*pi.*al.^3+(-5).*al.^2.*be+84.*pi.*al.*be.^2+71.*be.^3) ...
  +48.*a0.^6.*r.^4.*((-27).*al.^2.*be+(-43).*be.^3+12.*pi.*(al.^3+3.*al.* ...
  be.^2))+(-4).*a0.^13.*pi.^2.*r.^2.*(239.*al.^2.*be+715.*be.^3+60.*pi.* ...
  (3.*al.^3+7.*al.*be.^2))+a0.^3.*r.^4.*(633.*al.^2.*be+1085.*be.^3+(-12) ...
  .*pi.*(23.*al.^3+75.*al.*be.^2))+2.*a0.^9.*r.^4.*(817.*al.^2.*be+1173.* ...
  be.^3+(-12).*pi.*(31.*al.^3+83.*al.*be.^2))+(-384).*a0.^8.*pi.^4.*(2.* ...
  pi.*al+be).*lambda+4.*a0.^4.*pi.^2.*r.^2.*((-283).*al.^2.*be+(-199).*be.^3+ ...
  12.*pi.*al.*(5.*al.^2+17.*be.^2+(-4).*lambda)+72.*be.*lambda)+(-4).*a0.^7.* ...
  pi.^2.*r.^2.*((-307).*al.^2.*be+33.*be.^3+12.*pi.*al.*(13.*al.^2+41.* ...
  be.^2+(-8).*lambda)+144.*be.*lambda)+4.*a0.^10.*pi.^2.*r.^2.*(12.*pi.*al.*(17.* ...
  al.^2+45.*be.^2+(-4).*lambda)+be.*(225.*al.^2+805.*be.^2+72.*lambda)))+4.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*((-12).*a0.^16.*pi.^2.*r.^2.* ...
  (3.*al.^2+7.*be.^2).*((-1).*be+2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.* ...
  pi.^4.*lambda.*((-1).*be+2.*pi.*al.*((-1)+2.*x))+6.*a0.^13.*pi.^2.*r.^2.* ...
  ((-59).*al.^2.*be+(-95).*be.^3+10.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  2.*x))+(-48).*a0.^6.*r.^4.*(19.*be.^3+3.*pi.*al.*(al.^2+3.*be.^2).*(( ...
  -1)+6.*x))+9.*a0.^15.*r.^4.*(2.*be.*(al.^2+23.*be.^2)+3.*pi.*al.*(3.* ...
  al.^2+7.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.*r.^4.*(2.*be.*(al.^2+23.* ...
  be.^2)+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+6.*x))+r.^4.*(2.*be.*( ...
  al.^2+(-53).*be.^2)+(-3).*pi.*al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+ ...
  a0.^3.*r.^4.*((-6).*al.^2.*be+470.*be.^3+3.*pi.*al.*(23.*al.^2+75.* ...
  be.^2).*((-1)+6.*x))+2.*a0.^9.*r.^4.*(10.*al.^2.*be+534.*be.^3+3.*pi.* ...
  al.*(31.*al.^2+83.*be.^2).*((-1)+6.*x))+(-1).*a0.^12.*r.^4.*(30.* ...
  al.^2.*be+842.*be.^3+3.*pi.*al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+( ...
  -6).*a0.^4.*pi.^2.*r.^2.*(be.*(39.*al.^2+43.*be.^2+(-12).*lambda)+2.*pi.* ...
  al.*(4.*lambda.*(1+(-6).*x)+5.*al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x))) ...
  +6.*a0.^7.*pi.^2.*r.^2.*(be.*(31.*al.^2+19.*be.^2+(-24).*lambda)+2.*pi.* ...
  al.*(8.*lambda.*(1+(-6).*x)+13.*al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)) ...
  )+(-6).*a0.^10.*pi.^2.*r.^2.*((-1).*be.*(61.*al.^2+105.*be.^2+12.*lambda)+ ...
  2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1) ...
  +2.*x)))).*cos(2.*pi.*x)+(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.* ...
  r.^2).*(32.*((-1)+a0.^3).^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*cos(4.* ...
  pi.*x)+(-1).*((-1)+a0.^3).^2.*(5+(-3).*a0.^3+6.*a0.^6).*r.^2.*( ...
  12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+be.^2).* ...
  cos(6.*pi.*x)+(-2).*(144.*a0.^6.*r.^4.*(al.^2+3.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+(-27).*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+6.*a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.*be.*( ...
  1+(-2).*x))+3.*r.^4.*(5.*al.^2+17.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-3).*a0.^3.*r.^4.*(23.*al.^2+75.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-6).*a0.^9.*r.^4.*(31.*al.^2+83.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +3.*a0.^12.*r.^4.*(53.*al.^2+129.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x))+ ...
  192.*a0.^8.*pi.^4.*lambda.*(3.*al+2.*pi.*be.*((-1)+6.*x))+(-16).*a0.^16.* ...
  pi.^2.*r.^2.*(9.*al.^3+(-19).*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+ ...
  21.*pi.*be.^3.*((-1)+6.*x))+8.*a0.^13.*pi.^2.*r.^2.*(95.*al.^3+(-5) ...
  .*al.*be.^2+9.*pi.*be.^3.*((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x) ...
  )+(-8).*a0.^4.*pi.^2.*r.^2.*((-35).*al.^3+al.*((-119).*be.^2+6.*lambda)+ ...
  3.*pi.*al.^2.*be.*(11+30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+ ...
  102.*x)))+8.*a0.^7.*pi.^2.*r.^2.*((-11).*al.^3+al.*((-167).*be.^2+ ...
  12.*lambda)+9.*pi.*al.^2.*be.*(1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+ ...
  be.^2.*((-25)+246.*x)))+(-8).*a0.^10.*pi.^2.*r.^2.*(101.*al.^3+al.*(( ...
  -15).*be.^2+6.*lambda)+9.*pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+( ...
  -8).*lambda.*x+be.^2.*((-61)+270.*x)))).*sin(2.*pi.*x)+64.*((-1)+a0.^3) ...
  .^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+ ...
  a0.^3).^2.*r.^2).*al.*be.^2.*sin(4.*pi.*x)+((-1)+a0.^3).^2.*(5+(-3) ...
  .*a0.^3+6.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2) ...
  .*al.*(al.^2+(-3).*be.^2).*sin(6.*pi.*x)));

end

function wv = wv4(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=-pars.be;
al=0;
r=pars.r;

wv=(1/384).*pi.^(-2).*(48.*a0.^12.*pi.^4+40.*a0.^8.*((-1)+a0.^3).^2.* ...
  pi.^2.*r.^2+3.*((-1).*a0+a0.^4).^4.*r.^4).^(-1).*((-1).*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(8.*a0.^16.*pi.^2.*r.^2.*( ...
  45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+2.*a0.^18.* ...
  r.^4.*(45.*al.^3+36.*pi.*al.^2.*be+25.*al.*be.^2+84.*pi.*be.^3)+(-384).* ...
  a0.^8.*pi.^4.*(3.*al+2.*pi.*be).*lambda+3.*a0.^12.*r.^4.*(329.*al.^3+261.* ...
  al.*be.^2+4.*pi.*al.^2.*be.*(53+(-48).*x)+12.*pi.*be.^3.*(43+(-16).*x)) ...
  +(-1).*a0.^15.*r.^4.*(469.*al.^3+321.*al.*be.^2+12.*pi.*al.^2.*be.*(27+ ...
  (-16).*x)+12.*pi.*be.^3.*(63+(-16).*x))+(-2).*a0.^9.*r.^4.*(529.* ...
  al.^3+461.*al.*be.^2+12.*pi.*al.^2.*be.*(31+(-16).*x)+12.*pi.*be.^3.*( ...
  83+(-16).*x))+16.*a0.^6.*r.^4.*(37.*al.^3+33.*al.*be.^2+12.*pi.* ...
  al.^2.*be.*(3+2.*x)+12.*pi.*be.^3.*(9+2.*x))+r.^4.*(11.*al.^3+(-1).* ...
  al.*be.^2+12.*pi.*al.^2.*be.*(5+16.*x)+12.*pi.*be.^3.*(17+16.*x))+4.* ...
  a0.^13.*pi.^2.*r.^2.*((-217).*al.^3+(-53).*al.*be.^2+36.*pi.*be.^3.*(( ...
  -17)+16.*x)+12.*pi.*al.^2.*be.*((-31)+48.*x))+(-3).*a0.^3.*r.^4.*( ...
  51.*al.^3+39.*al.*be.^2+12.*pi.*be.^3.*(25+16.*x)+4.*pi.*al.^2.*be.*(23+ ...
  48.*x))+4.*a0.^4.*pi.^2.*r.^2.*(83.*al.^3+al.*(167.*be.^2+(-72).*lambda)+ ...
  12.*pi.*al.^2.*be.*((-11)+48.*x)+12.*pi.*be.*(be.^2+(-4).*lambda+48.*be.^2.* ...
  x))+(-4).*a0.^10.*pi.^2.*r.^2.*((-247).*al.^3+al.*((-123).*be.^2+72.* ...
  lambda)+36.*pi.*al.^2.*be.*((-11)+16.*x)+12.*pi.*be.*(4.*lambda+be.^2.*((-61)+ ...
  48.*x)))+(-4).*a0.^7.*pi.^2.*r.^2.*(203.*al.^3+al.*(287.*be.^2+(-144) ...
  .*lambda)+36.*pi.*al.^2.*be.*((-1)+16.*x)+12.*pi.*be.*((-8).*lambda+be.^2.*(25+ ...
  48.*x))))+2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*(6.* ...
  a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(3.*al+2.*pi.*be.*(1+(-2).*x))+(-3) ...
  .*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(31.*al+18.*pi.*be.*(1+(-2).*x))+ ...
  3.*r.^4.*(3.*al.^3+23.*al.*be.^2+10.*pi.*al.^2.*be.*(1+(-2).*x)+34.* ...
  pi.*be.^3.*(1+(-2).*x))+24.*a0.^6.*r.^4.*(15.*al.^3+47.*al.*be.^2+12.* ...
  pi.*al.^2.*be.*(1+(-2).*x)+36.*pi.*be.^3.*(1+(-2).*x))+(-3).*a0.^3.* ...
  r.^4.*(33.*al.^3+141.*al.*be.^2+46.*pi.*al.^2.*be.*(1+(-2).*x)+150.* ...
  pi.*be.^3.*(1+(-2).*x))+(-6).*a0.^9.*r.^4.*(105.*al.^3+277.*al.*be.^2+ ...
  62.*pi.*al.^2.*be.*(1+(-2).*x)+166.*pi.*be.^3.*(1+(-2).*x))+3.* ...
  a0.^12.*r.^4.*(195.*al.^3+471.*al.*be.^2+106.*pi.*al.^2.*be.*(1+(-2).* ...
  x)+258.*pi.*be.^3.*(1+(-2).*x))+192.*a0.^8.*pi.^4.*lambda.*((-3).*al+2.* ...
  pi.*be.*((-1)+6.*x))+(-16).*a0.^16.*pi.^2.*r.^2.*((-18).*al.^3+(-82) ...
  .*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+21.*pi.*be.^3.*((-1)+6.*x))+ ...
  8.*a0.^13.*pi.^2.*r.^2.*((-94).*al.^3+(-446).*al.*be.^2+9.*pi.*be.^3.* ...
  ((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x))+(-8).*a0.^4.*pi.^2.* ...
  r.^2.*((-26).*al.^3+2.*al.*((-73).*be.^2+9.*lambda)+3.*pi.*al.^2.*be.*(11+ ...
  30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+102.*x)))+8.*a0.^7.* ...
  pi.^2.*r.^2.*((-74).*al.^3+al.*((-410).*be.^2+36.*lambda)+9.*pi.*al.^2.*be.* ...
  (1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+be.^2.*((-25)+246.*x)))+(-8) ...
  .*a0.^10.*pi.^2.*r.^2.*((-106).*al.^3+6.*al.*((-91).*be.^2+3.*lambda)+9.* ...
  pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-61) ...
  +270.*x)))).*cos(2.*pi.*x)+(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*((-32).*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*( ...
  4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*be.^2.*cos(4.*pi.*x)+ ...
  (-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*al.*(al.^2+(-3).*be.^2).*cos( ...
  6.*pi.*x)+4.*((-12).*a0.^16.*pi.^2.*r.^2.*(3.*al.^2+7.*be.^2).*(be+ ...
  2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.*pi.^4.*lambda.*(be+2.*pi.*al.*((-1)+2.* ...
  x))+6.*a0.^13.*pi.^2.*r.^2.*((-17).*al.^2.*be+3.*be.^3+10.*pi.*al.*( ...
  3.*al.^2+7.*be.^2).*((-1)+2.*x))+(-12).*a0.^6.*r.^4.*(27.*al.^2.*be+ ...
  163.*be.^3+12.*pi.*al.*(al.^2+3.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.* ...
  r.^4.*(29.*al.^2.*be+109.*be.^3+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  6.*x))+9.*a0.^15.*r.^4.*(35.*al.^2.*be+123.*be.^3+3.*pi.*al.*(3.*al.^2+ ...
  7.*be.^2).*((-1)+6.*x))+r.^4.*(11.*al.^2.*be+(-133).*be.^3+(-3).*pi.* ...
  al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+a0.^3.*r.^4.*(39.*al.^2.*be+ ...
  767.*be.^3+3.*pi.*al.*(23.*al.^2+75.*be.^2).*((-1)+6.*x))+2.*a0.^9.* ...
  r.^4.*(7.*be.*(49.*al.^2+201.*be.^2)+3.*pi.*al.*(31.*al.^2+83.*be.^2).*( ...
  (-1)+6.*x))+(-1).*a0.^12.*r.^4.*(669.*al.^2.*be+2381.*be.^3+3.*pi.* ...
  al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+(-6).*a0.^4.*pi.^2.*r.^2.*( ...
  be.*(37.*al.^2+49.*be.^2+(-36).*lambda)+2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+5.* ...
  al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x)))+6.*a0.^7.*pi.^2.*r.^2.*( ...
  be.*(45.*al.^2+73.*be.^2+(-72).*lambda)+2.*pi.*al.*(8.*lambda.*(1+(-6).*x)+13.* ...
  al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)))+(-6).*a0.^10.*pi.^2.* ...
  r.^2.*((-15).*al.^2.*be+13.*be.^3+(-36).*be.*lambda+2.*pi.*al.*(4.*lambda.*(1+( ...
  -6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1)+2.*x)))).*sin(2.* ...
  pi.*x)+16.*((-1)+a0.^3).^2.*(5+(-7).*a0.^3+8.*a0.^6).*r.^2.*(4.* ...
  a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*sin( ...
  4.*pi.*x)+(-1).*((-1)+a0.^3).^2.*(7+(-17).*a0.^3+18.*a0.^6).* ...
  r.^2.*(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+ ...
  be.^2).*sin(6.*pi.*x)));
end
function wth=wth4(x,pars)
a0=pars.a0;
lambda=pars.lambda;
be=-pars.be;
al=0;
r=pars.r;

wth=(1/768).*((-1)+a0).*a0.^(-6).*(1+a0+a0.^2).*pi.^(-3).*r.*(48.* ...
  a0.^8.*pi.^4+40.*a0.^4.*((-1)+a0.^3).^2.*pi.^2.*r.^2+3.*((-1)+ ...
  a0.^3).^4.*r.^4).^(-1).*((-1).*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.* ...
  r.^2).*(a0.^12.*r.^4.*(636.*pi.*al.^3+(-1371).*al.^2.*be+1548.*pi.* ...
  al.*be.^2+(-1799).*be.^3)+r.^4.*(60.*pi.*al.^3+(-139).*al.^2.*be+204.* ...
  pi.*al.*be.^2+(-247).*be.^3)+(-9).*a0.^15.*r.^4.*(36.*pi.*al.^3+(-77) ...
  .*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+2.*a0.^18.*r.^4.*(36.*pi.* ...
  al.^3+(-77).*al.^2.*be+84.*pi.*al.*be.^2+(-97).*be.^3)+8.*a0.^16.* ...
  pi.^2.*r.^2.*(36.*pi.*al.^3+(-5).*al.^2.*be+84.*pi.*al.*be.^2+71.*be.^3) ...
  +48.*a0.^6.*r.^4.*((-27).*al.^2.*be+(-43).*be.^3+12.*pi.*(al.^3+3.*al.* ...
  be.^2))+(-4).*a0.^13.*pi.^2.*r.^2.*(239.*al.^2.*be+715.*be.^3+60.*pi.* ...
  (3.*al.^3+7.*al.*be.^2))+a0.^3.*r.^4.*(633.*al.^2.*be+1085.*be.^3+(-12) ...
  .*pi.*(23.*al.^3+75.*al.*be.^2))+2.*a0.^9.*r.^4.*(817.*al.^2.*be+1173.* ...
  be.^3+(-12).*pi.*(31.*al.^3+83.*al.*be.^2))+(-384).*a0.^8.*pi.^4.*(2.* ...
  pi.*al+be).*lambda+4.*a0.^4.*pi.^2.*r.^2.*((-283).*al.^2.*be+(-199).*be.^3+ ...
  12.*pi.*al.*(5.*al.^2+17.*be.^2+(-4).*lambda)+72.*be.*lambda)+(-4).*a0.^7.* ...
  pi.^2.*r.^2.*((-307).*al.^2.*be+33.*be.^3+12.*pi.*al.*(13.*al.^2+41.* ...
  be.^2+(-8).*lambda)+144.*be.*lambda)+4.*a0.^10.*pi.^2.*r.^2.*(12.*pi.*al.*(17.* ...
  al.^2+45.*be.^2+(-4).*lambda)+be.*(225.*al.^2+805.*be.^2+72.*lambda)))+4.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*((-12).*a0.^16.*pi.^2.*r.^2.* ...
  (3.*al.^2+7.*be.^2).*((-1).*be+2.*pi.*al.*((-1)+2.*x))+96.*a0.^8.* ...
  pi.^4.*lambda.*((-1).*be+2.*pi.*al.*((-1)+2.*x))+6.*a0.^13.*pi.^2.*r.^2.* ...
  ((-59).*al.^2.*be+(-95).*be.^3+10.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+ ...
  2.*x))+(-48).*a0.^6.*r.^4.*(19.*be.^3+3.*pi.*al.*(al.^2+3.*be.^2).*(( ...
  -1)+6.*x))+9.*a0.^15.*r.^4.*(2.*be.*(al.^2+23.*be.^2)+3.*pi.*al.*(3.* ...
  al.^2+7.*be.^2).*((-1)+6.*x))+(-2).*a0.^18.*r.^4.*(2.*be.*(al.^2+23.* ...
  be.^2)+3.*pi.*al.*(3.*al.^2+7.*be.^2).*((-1)+6.*x))+r.^4.*(2.*be.*( ...
  al.^2+(-53).*be.^2)+(-3).*pi.*al.*(5.*al.^2+17.*be.^2).*((-1)+6.*x))+ ...
  a0.^3.*r.^4.*((-6).*al.^2.*be+470.*be.^3+3.*pi.*al.*(23.*al.^2+75.* ...
  be.^2).*((-1)+6.*x))+2.*a0.^9.*r.^4.*(10.*al.^2.*be+534.*be.^3+3.*pi.* ...
  al.*(31.*al.^2+83.*be.^2).*((-1)+6.*x))+(-1).*a0.^12.*r.^4.*(30.* ...
  al.^2.*be+842.*be.^3+3.*pi.*al.*(53.*al.^2+129.*be.^2).*((-1)+6.*x))+( ...
  -6).*a0.^4.*pi.^2.*r.^2.*(be.*(39.*al.^2+43.*be.^2+(-12).*lambda)+2.*pi.* ...
  al.*(4.*lambda.*(1+(-6).*x)+5.*al.^2.*((-1)+2.*x)+17.*be.^2.*((-1)+2.*x))) ...
  +6.*a0.^7.*pi.^2.*r.^2.*(be.*(31.*al.^2+19.*be.^2+(-24).*lambda)+2.*pi.* ...
  al.*(8.*lambda.*(1+(-6).*x)+13.*al.^2.*((-1)+2.*x)+41.*be.^2.*((-1)+2.*x)) ...
  )+(-6).*a0.^10.*pi.^2.*r.^2.*((-1).*be.*(61.*al.^2+105.*be.^2+12.*lambda)+ ...
  2.*pi.*al.*(4.*lambda.*(1+(-6).*x)+17.*al.^2.*((-1)+2.*x)+45.*be.^2.*((-1) ...
  +2.*x)))).*cos(2.*pi.*x)+(4.*a0.^4.*pi.^2+3.*((-1)+a0.^3).^2.* ...
  r.^2).*(32.*((-1)+a0.^3).^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.* ...
  a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-1).*al.^2+be.^2).*cos(4.* ...
  pi.*x)+(-1).*((-1)+a0.^3).^2.*(5+(-3).*a0.^3+6.*a0.^6).*r.^2.*( ...
  12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2).*be.*((-3).*al.^2+be.^2).* ...
  cos(6.*pi.*x)+(-2).*(144.*a0.^6.*r.^4.*(al.^2+3.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+(-27).*a0.^15.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.* ...
  be.*(1+(-2).*x))+6.*a0.^18.*r.^4.*(3.*al.^2+7.*be.^2).*(al+2.*pi.*be.*( ...
  1+(-2).*x))+3.*r.^4.*(5.*al.^2+17.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-3).*a0.^3.*r.^4.*(23.*al.^2+75.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +(-6).*a0.^9.*r.^4.*(31.*al.^2+83.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x)) ...
  +3.*a0.^12.*r.^4.*(53.*al.^2+129.*be.^2).*(al+2.*pi.*be.*(1+(-2).*x))+ ...
  192.*a0.^8.*pi.^4.*lambda.*(3.*al+2.*pi.*be.*((-1)+6.*x))+(-16).*a0.^16.* ...
  pi.^2.*r.^2.*(9.*al.^3+(-19).*al.*be.^2+9.*pi.*al.^2.*be.*((-1)+6.*x)+ ...
  21.*pi.*be.^3.*((-1)+6.*x))+8.*a0.^13.*pi.^2.*r.^2.*(95.*al.^3+(-5) ...
  .*al.*be.^2+9.*pi.*be.^3.*((-17)+70.*x)+3.*pi.*al.^2.*be.*((-31)+90.*x) ...
  )+(-8).*a0.^4.*pi.^2.*r.^2.*((-35).*al.^3+al.*((-119).*be.^2+6.*lambda)+ ...
  3.*pi.*al.^2.*be.*(11+30.*x)+3.*pi.*be.*(4.*lambda+(-8).*lambda.*x+be.^2.*((-1)+ ...
  102.*x)))+8.*a0.^7.*pi.^2.*r.^2.*((-11).*al.^3+al.*((-167).*be.^2+ ...
  12.*lambda)+9.*pi.*al.^2.*be.*(1+26.*x)+3.*pi.*be.*(8.*lambda.*(1+(-2).*x)+ ...
  be.^2.*((-25)+246.*x)))+(-8).*a0.^10.*pi.^2.*r.^2.*(101.*al.^3+al.*(( ...
  -15).*be.^2+6.*lambda)+9.*pi.*al.^2.*be.*((-11)+34.*x)+3.*pi.*be.*(4.*lambda+( ...
  -8).*lambda.*x+be.^2.*((-61)+270.*x)))).*sin(2.*pi.*x)+64.*((-1)+a0.^3) ...
  .^2.*(2+(-1).*a0.^3+2.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+ ...
  a0.^3).^2.*r.^2).*al.*be.^2.*sin(4.*pi.*x)+((-1)+a0.^3).^2.*(5+(-3) ...
  .*a0.^3+6.*a0.^6).*r.^2.*(12.*a0.^4.*pi.^2+((-1)+a0.^3).^2.*r.^2) ...
  .*al.*(al.^2+(-3).*be.^2).*sin(6.*pi.*x)));

end
